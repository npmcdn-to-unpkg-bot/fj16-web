!function(t,e){function n(){}function o(){}function i(){}function a(t,e){"string"==typeof e&&(e=e.split("."));var n,o=e.join(".").replace(/\.(\w)/g,function(t,e){return e.toUpperCase()}),i=e.shift();return typeof(n=t[o])!=c?n=n:typeof(n=t[i])!=c&&e.length>0&&(n=a(n,e)),n}function s(){function t(t,e){i.bind(t,function(){return e.apply(o,arguments)})}var e,n=g.apply(arguments),o=this,i=1===n.length?o:n.shift();n=n[0]||{};for(e in n)t(e,n[e])}function r(t,e){return{input:t,form:e}}var u,l=(JSON||{}).stringify,g=Array.prototype.slice,c="undefined",d="item.manager",p="plugins",f="ext",h="html.wrap",m="html.hidden",v="keys",x="preInvalidate",w="postInvalidate",y="getFormData",D="setFormData",E="setInputData",I="postInit",S="ready",T={itemManager:o,plugins:[],ext:{},html:{wrap:'<div class="text-core"><div class="text-wrap"/></div>',hidden:'<input type="hidden" />'},keys:{8:"backspace",9:"tab",13:"enter!",27:"escape!",37:"left",38:"up!",39:"right",40:"down!",46:"delete",108:"numpadEnter"}};if(!l)throw new Error("JSON.stringify() not found");u=o.prototype,u.init=function(t){},u.filter=function(t,e){var n,o,i=[];for(n=0;n<t.length;n++)o=t[n],this.itemContains(o,e)&&i.push(o);return i},u.itemContains=function(t,e){return 0==this.itemToString(t).toLowerCase().indexOf(e.toLowerCase())},u.stringToItem=function(t){return t},u.itemToString=function(t){return t},u.compareItems=function(t,e){return t==e},u=n.prototype,u.init=function(e,n){var o,i,a,s=this;s._defaults=t.extend({},T),s._opts=n||{},s._plugins={},s._itemManager=i=new(s.opts(d)),e=t(e),a=t(s.opts(h)),o=t(s.opts(m)),e.wrap(a).keydown(function(t){return s.onKeyDown(t)}).keyup(function(t){return s.onKeyUp(t)}).data("textext",s),t(s).data({hiddenInput:o,wrapElement:e.parents(".text-wrap").first(),input:e}),o.attr("name",e.attr("name")),e.attr("name",null),o.insertAfter(e),t.extend(!0,i,s.opts(f+".item.manager")),t.extend(!0,s,s.opts(f+".*"),s.opts(f+".core")),s.originalWidth=e.outerWidth(),s.invalidateBounds(),i.init(s),s.initPatches(),s.initPlugins(s.opts(p),t.fn.textext.plugins),s.on({setFormData:s.onSetFormData,getFormData:s.onGetFormData,setInputData:s.onSetInputData,anyKeyUp:s.onAnyKeyUp}),s.trigger(I),s.trigger(S),s.getFormData(0)},u.initPatches=function(){var e,n=[],o=t.fn.textext.patches;for(e in o)n.push(e);this.initPlugins(n,o)},u.initPlugins=function(e,n){var o,i,a,s=this,r=[];for("string"==typeof e&&(e=e.split(/\s*,\s*|\s+/g)),a=0;a<e.length;a++)o=e[a],i=n[o],i&&(s._plugins[o]=i=new i,s[o]=function(t){return function(){return t}}(i),r.push(i),t.extend(!0,i,s.opts(f+".*"),s.opts(f+"."+o)));for(r.sort(function(t,e){return t=t.initPriority(),e=e.initPriority(),t===e?0:e>t?1:-1}),a=0;a<r.length;a++)r[a].init(s)},u.hasPlugin=function(t){return!!this._plugins[t]},u.on=s,u.bind=function(t,e){this.input().bind(t,e)},u.trigger=function(){var t=arguments;this.input().trigger(t[0],g.call(t,1))},u.itemManager=function(){return this._itemManager},u.input=function(){return t(this).data("input")},u.opts=function(t){var e=a(this._opts,t);return"undefined"==typeof e?a(this._defaults,t):e},u.wrapElement=function(){return t(this).data("wrapElement")},u.invalidateBounds=function(){var t,e=this,n=e.input(),o=e.wrapElement(),i=o.parent(),a=e.originalWidth+"px";e.trigger(x),t=n.outerHeight()+"px",n.css({width:a}),o.css({width:a,height:t}),i.css({height:t}),e.trigger(w)},u.focusInput=function(){this.input()[0].focus()},u.serializeData=l,u.hiddenInput=function(e){return t(this).data("hiddenInput")},u.getWeightedEventResponse=function(t,e){var n=this,o={},i=0;n.trigger(t,o,e);for(var a in o)i=Math.max(i,a);return o[i]},u.getFormData=function(t){var e=this,n=e.getWeightedEventResponse(y,t||0);e.trigger(D,n.form),e.trigger(E,n.input)},u.onAnyKeyUp=function(t,e){this.getFormData(e)},u.onSetInputData=function(t,e){this.input().val(e)},u.onSetFormData=function(t,e){var n=this;n.hiddenInput().val(n.serializeData(e))},u.onGetFormData=function(t,e){var n=this.input().val();e[0]=r(n,n)},t(["Down","Up"]).each(function(){var t=this.toString();u["onKey"+t]=function(e){var n=this,o=n.opts(v)[e.keyCode],i=!0;return o&&(i="!"!=o.substr(-1),o=o.replace("!",""),n.trigger(o+"Key"+t),"Up"==t&&n._lastKeyDown==e.keyCode&&(n._lastKeyDown=null,n.trigger(o+"KeyPress")),"Down"==t&&(n._lastKeyDown=e.keyCode)),n.trigger("anyKey"+t,e.keyCode),i}}),u=i.prototype,u.on=s,u.formDataObject=r,u.init=function(t){throw new Error("Not implemented")},u.baseInit=function(e,n){var o=this;e._defaults=t.extend(!0,e._defaults,n),o._core=e,o._timers={}},u.startTimer=function(t,e,n){var o=this;o.stopTimer(t),o._timers[t]=setTimeout(function(){delete o._timers[t],n.apply(o)},1e3*e)},u.stopTimer=function(t){clearTimeout(this._timers[t])},u.core=function(){return this._core},u.opts=function(t){return this.core().opts(t)},u.itemManager=function(){return this.core().itemManager()},u.input=function(){return this.core().input()},u.val=function(t){var e=this.input();return typeof t===c?e.val():void e.val(t)},u.trigger=function(){var t=this.core();t.trigger.apply(t,arguments)},u.bind=function(t,e){this.core().bind(t,e)},u.initPriority=function(){return 0};var b=!1,P=t.fn.textext=function(e){var o;return b||null==(o=t.fn.textext.css)||(t("head").append("<style>"+o+"</style>"),b=!0),this.map(function(){var o=t(this);if(null==e)return o.data("textext");var i=new n;return i.init(o,e),o.data("textext",i),i.input()[0]})};P.addPlugin=function(t,e){P.plugins[t]=e,e.prototype=new P.TextExtPlugin},P.addPatch=function(t,e){P.patches[t]=e,e.prototype=new P.TextExtPlugin},P.TextExt=n,P.TextExtPlugin=i,P.ItemManager=o,P.plugins={},P.patches={}}(jQuery),function(t){function e(){}t.fn.textext.TextExtIE9Patches=e,t.fn.textext.addPatch("ie9",e);var n=e.prototype;n.init=function(t){if(-1!=navigator.userAgent.indexOf("MSIE 9")){var e=this;t.on({postInvalidate:e.onPostInvalidate})}},n.onPostInvalidate=function(){var t=this,e=t.input(),n=e.val();e.val(Math.random()),e.val(n)}}(jQuery),function(t){function e(){}t.fn.textext.TextExtAjax=e,t.fn.textext.addPlugin("ajax",e);var n=e.prototype,o="ajax.data.callback",i="ajax.cache.results",a="ajax.loading.delay",s="ajax.loading.message",r="ajax.type.delay",u="setSuggestions",l="showDropdown",g="loading",c={ajax:{typeDelay:.5,loadingMessage:"Loading...",loadingDelay:.5,cacheResults:!1,dataCallback:null}};n.init=function(t){var e=this;e.baseInit(t,c),e.on({getSuggestions:e.onGetSuggestions}),e._suggestions=null},n.load=function(e){var n,i=this,a=i.opts(o)||function(t){return{q:t}};n=t.extend(!0,{data:a(e),success:function(t){i.onComplete(t,e)},error:function(t,n){console.error(n,e)}},i.opts("ajax")),t.ajax(n)},n.onComplete=function(t,e){var n=this,o=t;n.dontShowLoading(),1==n.opts(i)&&(n._suggestions=t,o=n.itemManager().filter(t,e)),n.trigger(u,{result:o})},n.dontShowLoading=function(){this.stopTimer(g)},n.showLoading=function(){var t=this;t.dontShowLoading(),t.startTimer(g,t.opts(a),function(){t.trigger(l,function(e){e.clearItems();var n=e.addDropdownItem(t.opts(s));n.addClass("text-loading")})})},n.onGetSuggestions=function(t,e){var n=this,o=n._suggestions,a=(e||{}).query||"";return o&&n.opts(i)===!0?n.onComplete(o,a):void n.startTimer("ajax",n.opts(r),function(){n.showLoading(),n.load(a)})}}(jQuery),function(t){function e(){}t.fn.textext.TextExtAutocomplete=e,t.fn.textext.addPlugin("autocomplete",e);var n=e.prototype,o=".",i="text-selected",a=o+i,s="text-suggestion",r=o+s,u="text-label",l=o+u,g="autocomplete.enabled",c="autocomplete.dropdown.position",d="autocomplete.dropdown.maxHeight",p="autocomplete.render",f="html.dropdown",h="html.suggestion",m="hideDropdown",v="showDropdown",x="getSuggestions",w="above",y="below",D="mousedownOnAutocomplete",E={autocomplete:{enabled:!0,dropdown:{position:y,maxHeight:"100px"}},html:{dropdown:'<div class="text-dropdown"><div class="text-list"/></div>',suggestion:'<div class="text-suggestion"><span class="text-label"/></div>'}};n.init=function(e){var n=this;n.baseInit(e,E);var o,i=n.input();n.opts(g)===!0&&(n.on({blur:n.onBlur,anyKeyUp:n.onAnyKeyUp,deleteKeyUp:n.onAnyKeyUp,backspaceKeyPress:n.onBackspaceKeyPress,enterKeyPress:n.onEnterKeyPress,escapeKeyPress:n.onEscapeKeyPress,setSuggestions:n.onSetSuggestions,showDropdown:n.onShowDropdown,hideDropdown:n.onHideDropdown,toggleDropdown:n.onToggleDropdown,postInvalidate:n.positionDropdown,getFormData:n.onGetFormData,downKeyDown:n.onDownKeyDown,upKeyDown:n.onUpKeyDown}),o=t(n.opts(f)),o.insertAfter(i),n.on(o,{mouseover:n.onMouseOver,mousedown:n.onMouseDown,click:n.onClick}),o.css("maxHeight",n.opts(d)).addClass("text-position-"+n.opts(c)),t(n).data("container",o),t(document.body).click(function(t){n.isDropdownVisible()&&!n.withinWrapElement(t.target)&&n.trigger(m)}),n.positionDropdown())},n.containerElement=function(){return t(this).data("container")},n.onMouseOver=function(e){var n=this,o=t(e.target);o.is(r)&&(n.clearSelected(),o.addClass(i))},n.onMouseDown=function(t){this.containerElement().data(D,!0)},n.onClick=function(e){var n=this,o=t(e.target);(o.is(r)||o.is(l))&&n.trigger("enterKeyPress"),n.core().hasPlugin("tags")&&n.val("")},n.onBlur=function(t){var e=this,n=e.containerElement(),o=n.data(D)===!0;e.isDropdownVisible()&&(o?e.core().focusInput():e.trigger(m)),n.removeData(D)},n.onBackspaceKeyPress=function(t){var e=this,n=e.val().length>0;(n||e.isDropdownVisible())&&e.getSuggestions()},n.onAnyKeyUp=function(t,e){var n=this,o=null!=n.opts("keys."+e);n.val().length>0&&!o&&n.getSuggestions()},n.onDownKeyDown=function(t){var e=this;e.isDropdownVisible()?e.toggleNextSuggestion():e.getSuggestions()},n.onUpKeyDown=function(t){this.togglePreviousSuggestion()},n.onEnterKeyPress=function(t){var e=this;e.isDropdownVisible()&&e.selectFromDropdown()},n.onEscapeKeyPress=function(t){var e=this;e.isDropdownVisible()&&e.trigger(m)},n.positionDropdown=function(){var t=this,e=t.containerElement(),n=t.opts(c),o=t.core().wrapElement().outerHeight(),i={};i[n===w?"bottom":"top"]=o+"px",e.css(i)},n.suggestionElements=function(){return this.containerElement().find(r)},n.setSelectedSuggestion=function(e){if(e){var n,o,a=this,r=a.suggestionElements(),u=r.first();for(a.clearSelected(),o=0;o<r.length;o++)if(n=t(r[o]),a.itemManager().compareItems(n.data(s),e)){u=n.addClass(i);break}u.addClass(i),a.scrollSuggestionIntoView(u)}},n.selectedSuggestionElement=function(){return this.suggestionElements().filter(a).first()},n.isDropdownVisible=function(){return this.containerElement().is(":visible")===!0},n.onGetFormData=function(t,e,n){var o=this,i=o.val(),a=i,s=i;e[100]=o.formDataObject(a,s)},n.initPriority=function(){return 200},n.onHideDropdown=function(t){this.hideDropdown()},n.onToggleDropdown=function(t){var e=this;e.trigger(e.containerElement().is(":visible")?m:v)},n.onShowDropdown=function(e,n){var o=this,i=o.selectedSuggestionElement().data(s),a=o._suggestions;return a?(t.isFunction(n)?n(o):(o.renderSuggestions(o._suggestions),o.toggleNextSuggestion()),o.showDropdown(o.containerElement()),void o.setSelectedSuggestion(i)):o.trigger(x)},n.onSetSuggestions=function(t,e){var n=this,o=n._suggestions=e.result;e.showHideDropdown!==!1&&n.trigger(null===o||0===o.length?m:v)},n.getSuggestions=function(){var t=this,e=t.val();t._previousInputValue!=e&&(""==e&&(current=null),t._previousInputValue=e,t.trigger(x,{query:e}))},n.clearItems=function(){this.containerElement().find(".text-list").children().remove()},n.renderSuggestions=function(e){var n=this;n.clearItems(),t.each(e||[],function(t,e){n.addSuggestion(e)})},n.showDropdown=function(){this.containerElement().show()},n.hideDropdown=function(){var t=this,e=t.containerElement();t._previousInputValue=null,e.hide()},n.addSuggestion=function(t){var e=this,n=e.opts(p),o=e.addDropdownItem(n?n.call(e,t):e.itemManager().itemToString(t));o.data(s,t)},n.addDropdownItem=function(e){var n=this,o=n.containerElement().find(".text-list"),i=t(n.opts(h));return i.find(".text-label").html(e),o.append(i),i},n.clearSelected=function(){this.suggestionElements().removeClass(i)},n.toggleNextSuggestion=function(){var t,e=this,n=e.selectedSuggestionElement();n.length>0?(t=n.next(),t.length>0&&n.removeClass(i)):t=e.suggestionElements().first(),t.addClass(i),e.scrollSuggestionIntoView(t)},n.togglePreviousSuggestion=function(){var t=this,e=t.selectedSuggestionElement(),n=e.prev();0!=n.length&&(t.clearSelected(),n.addClass(i),t.scrollSuggestionIntoView(n))},n.scrollSuggestionIntoView=function(t){var e=t.outerHeight(),n=this.containerElement(),o=n.innerHeight(),i=n.scrollTop(),a=(t.position()||{}).top,s=null,r=parseInt(n.css("paddingTop"));null!=a&&(a+e>o&&(s=a+i+e-o+r),0>a&&(s=a+i-r),null!=s&&n.scrollTop(s))},n.selectFromDropdown=function(){var t=this,e=t.selectedSuggestionElement().data(s);e&&(t.val(t.itemManager().itemToString(e)),t.core().getFormData()),t.trigger(m)},n.withinWrapElement=function(t){return this.core().wrapElement().find(t).size()>0}}(jQuery),function(t){function e(){}t.fn.textext.TextExtFilter=e,t.fn.textext.addPlugin("filter",e);var n=e.prototype,o="filter.enabled",i={filter:{enabled:!0,items:null}};n.init=function(t){var e=this;e.baseInit(t,i),e.on({getFormData:e.onGetFormData,isTagAllowed:e.onIsTagAllowed,setSuggestions:e.onSetSuggestions}),e._suggestions=null},n.onGetFormData=function(t,e,n){var o=this,i=o.val(),a=i,s="";o.core().hasPlugin("tags")||(o.isValueAllowed(a)&&(s=i),e[300]=o.formDataObject(a,s))},n.isValueAllowed=function(t){var e,n=this,i=n.opts("filterItems")||n._suggestions||[],a=n.itemManager(),s=!n.opts(o);for(e=0;e<i.length&&!s;e++)a.compareItems(t,i[e])&&(s=!0);return s},n.onIsTagAllowed=function(t,e){e.result=this.isValueAllowed(e.tag)},n.onSetSuggestions=function(t,e){this._suggestions=e.result}}(jQuery),function(t){function e(){}t.fn.textext.TextExtTags=e,t.fn.textext.addPlugin("tags",e);var n=e.prototype,o=".",i="text-tags-on-top",a=o+i,s="text-tag",r=o+s,u="text-tags",l=o+u,g="text-label",c=o+g,d="text-remove",p=o+d,f="tags.enabled",h="tags.items",m="html.tag",v="html.tags",x="isTagAllowed",w="tagClick",y={tags:{enabled:!0,items:null},html:{tags:'<div class="text-tags"/>',tag:'<div class="text-tag"><div class="text-button"><span class="text-label"/><a class="text-remove"/></div></div>'}};n.init=function(e){this.baseInit(e,y);var n,o=this,i=o.input();o.opts(f)&&(n=t(o.opts(v)),i.after(n),t(o).data("container",n),o.on({enterKeyPress:o.onEnterKeyPress,backspaceKeyDown:o.onBackspaceKeyDown,preInvalidate:o.onPreInvalidate,postInit:o.onPostInit,getFormData:o.onGetFormData}),o.on(n,{click:o.onClick,mousemove:o.onContainerMouseMove}),o.on(i,{mousemove:o.onInputMouseMove})),o._originalPadding={left:parseInt(i.css("paddingLeft")||0),top:parseInt(i.css("paddingTop")||0)},o._paddingBox={left:0,top:0},o.updateFormCache()},n.containerElement=function(){return t(this).data("container")},n.onPostInit=function(t){var e=this;e.addTags(e.opts(h))},n.onGetFormData=function(t,e,n){var o=this,i=13===n?"":o.val(),a=o._formData;e[200]=o.formDataObject(i,a)},n.initPriority=function(){return 100},n.onInputMouseMove=function(t){this.toggleZIndex(t)},n.onContainerMouseMove=function(t){this.toggleZIndex(t)},n.onBackspaceKeyDown=function(t){var e=this,n=e.tagElements().last();0==e.val().length&&e.removeTag(n)},n.onPreInvalidate=function(t){var e=this,n=e.tagElements().last(),o=n.position();n.length>0?o.left+=n.innerWidth():o=e._originalPadding,e._paddingBox=o,e.input().css({paddingLeft:o.left,paddingTop:o.top})},n.onClick=function(e){function n(t,e){o.data(s,t),o.find(c).text(i.itemManager().itemToString(t)),i.updateFormCache(),a.getFormData(),a.invalidateBounds(),e&&a.focusInput()}var o,i=this,a=i.core(),u=t(e.target),g=0;u.is(l)?g=1:u.is(p)?(i.removeTag(u.parents(r+":first")),g=1):u.is(c)&&(o=u.parents(r+":first"),i.trigger(w,o,o.data(s),n)),g&&a.focusInput()},n.onEnterKeyPress=function(t){var e=this,n=e.val(),o=e.itemManager().stringToItem(n);e.isTagAllowed(o)&&(e.addTags([o]),e.core().focusInput())},n.updateFormCache=function(){var e=this,n=[];e.tagElements().each(function(){n.push(t(this).data(s))}),e._formData=n},n.toggleZIndex=function(t){var e=this,n=e.input().offset(),o=t.clientX-n.left,s=t.clientY-n.top,r=e._paddingBox,u=e.containerElement(),l=u.is(a),g=o>r.left&&s>r.top;(!l&&!g||l&&g)&&u[(l?"remove":"add")+"Class"](i)},n.tagElements=function(){return this.containerElement().find(r)},n.isTagAllowed=function(t){var e={tag:t,result:!0};return this.trigger(x,e),e.result===!0},n.addTags=function(t){if(t&&0!=t.length){var e,n,o=this,i=o.core(),a=o.containerElement();for(e=0;e<t.length;e++)n=t[e],n&&o.isTagAllowed(n)&&a.append(o.renderTag(n));o.updateFormCache(),i.getFormData(),i.invalidateBounds()}},n.getTagElement=function(e){var n,o,i=this,a=i.tagElements();for(n=0;n<a.length;n++)if(o=t(a[n]),i.itemManager().compareItems(o.data(s),e))return o;return null},n.removeTag=function(e){var n,o=this,i=o.core();if(e instanceof t)n=e,e=e.data(s);else if(n=o.getTagElement(e),null===n)return;n.remove(),o.updateFormCache(),i.getFormData(),i.invalidateBounds()},n.renderTag=function(e){var n=this,o=t(n.opts(m));return o.find(".text-label").text(n.itemManager().itemToString(e)),o.data(s,e),o}}(jQuery);